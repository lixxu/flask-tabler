{% from "tabler/elements/base.html" import get_link, get_file_url %}

{% macro render_status() %}
  {% if kwargs.top_color %}<div class="card-status-top bg-{{ kwargs.top_color }}"></div>{% endif %}
  {% if kwargs.left_color %}<div class="card-status-start bg-{{ kwargs.left_color }}"></div>{% endif %}
  {% if kwargs.bottom_color %}<div class="card-status-bottom bg-{{ kwargs.bottom_color }}"></div>{% endif %}
{% endmacro %}

{% macro render_title() %}
  {% if kwargs.title_link %}
    <a href="{{ kwargs.title_link }}">{{ _(kwargs.title) }}</a>
  {% else %}
    {{ _(kwargs.title) }}
  {% endif %}
{% endmacro %}

{% macro render_content(body) %}
  {% if kwargs.title and kwargs.division %}
    <div class="card-header">
      <h3 class="card-title">{{ render_title(**kwargs) }}</h3>
    </div>
  {% endif %}
  <div class="card-body d-flex flex-column">
    {% if kwargs.title and not kwargs.division %}
      <h3 class="card-title">{{ render_title(**kwargs) }}</h3>
    {% endif %}
    <p {% if kwargs.mute %}class="text-secondary"{% endif %}>
      {{ _(body)|safe }}
    </p>
    {{ (kwargs.bottom_content or '')|safe }}
  </div>
  {{ (kwargs.extra_content or '')|safe }}
{% endmacro %}

{% macro render_img(img) %}
  {% if img %}
    <div class="col-md-{{ kwargs.img_col or 3 }}">
      <a href="{{ get_link() }}">
        <img src="{{ img }}" class="w-100 h-100 object-cover" alt="{{ _(kwargs.img_alt) or '' }}" />
      </a>
    </div>
  {% endif %}
{% endmacro %}

{% macro render_card(body="") %}
  <div class="card d-flex flex-column
    {% if kwargs.size %}card-{{ kwargs.size }}{% endif %}
    {{ kwargs.class or '' }}
    ">
    {{ render_status(**kwargs) }}
    {% if kwargs.top_img %}
      {% if kwargs.img_link %}
        <a href="{{ get_link(kwargs.img_link) }}">
          <img class="card-img-top" src="{{ get_file_url(kwargs.top_img, **kwargs) }}" alt="{{ _(kwargs.img_alt) or '' }}" />
        </a>
      {% else %}
        <div class="img-responsive img-responsive-21x9 card-img-top" style="background-image: url({{ get_file_url(kwargs.top_img, **kwargs) }})"></div>
      {% endif %}
    {% endif %}
    {% if kwargs.left_img or kwargs.right_img %}
      <div class="row row-0 flex-fill">
    {% endif %}
    {{ render_img(kwargs.left_img, **kwargs) }}
    {% if kwargs.left_img or kwargs.right_img %}<div class="col">{% endif %}
    {{ render_content(body, **kwargs) }}
    {{ render_img(kwargs.right_img, **kwargs) }}
    {% if kwargs.left_img or kwargs.right_img %}</div></div>{% endif %}
  </div>
{% endmacro %}

{% macro render_card_row_deck(cards=[], size="md-4") %}
  <div class="row row-deck {{ kwargs.class or '' }}">
    {% for card in cards %}
      <div class="col-{{ size }}">
        {{ render_card(**card) }}
      </div>
    {% endfor %}
  </div>
{% endmacro %}

{% macro render_card_stack(body="") %}
  <div class="card card-stacked {{ kwargs.class or '' }}">
    {{ render_status(**kwargs) }}
    {{ render_content(body, **kwargs) }}
  </div>
{% endmacro %}
